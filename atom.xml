<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://gbcat.github.io</id>
    <title>é»‘çŒ«.live</title>
    <updated>2021-07-20T03:30:28.042Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://gbcat.github.io"/>
    <link rel="self" href="https://gbcat.github.io/atom.xml"/>
    <subtitle>é‚£äº›è¯´å¤©ç©ºæ‹¥æœ‰æé™çš„äººéƒ½ä»æœªç¦»å¼€è¿‡åœ°é¢</subtitle>
    <logo>https://gbcat.github.io/images/avatar.png</logo>
    <icon>https://gbcat.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, é»‘çŒ«.live</rights>
    <entry>
        <title type="html"><![CDATA[Cocosæ¥å…¥[ç©¿å±±ç”²]+[å‹ç›ŸåŸºç¡€åŠŸèƒ½]æŒ‡å—]]></title>
        <id>https://gbcat.github.io/post/1/</id>
        <link href="https://gbcat.github.io/post/1/">
        </link>
        <updated>2021-07-20T02:47:39.000Z</updated>
        <content type="html"><![CDATA[<h1 id="cocosæ¥å…¥ç©¿å±±ç”²å‹ç›ŸåŸºç¡€åŠŸèƒ½æŒ‡å—">Cocosæ¥å…¥[ç©¿å±±ç”²]+[å‹ç›ŸåŸºç¡€åŠŸèƒ½]æŒ‡å—</h1>
<h2 id="æ”¯æŒçš„å¹¿å‘Šç±»å‹">æ”¯æŒçš„å¹¿å‘Šç±»å‹</h2>
<ul>
<li>å¼€å±å¹¿å‘Š</li>
<li>æ¿€åŠ±è§†é¢‘</li>
<li>æ¨¡æ¿æ¸²æŸ“æ’å±</li>
<li>æ¨¡æ¿æ¸²æŸ“Banner</li>
</ul>
<h2 id="æ–‡ä»¶ä¿®æ”¹è®°å½•">æ–‡ä»¶ä¿®æ”¹è®°å½•</h2>
<ul>
<li>res/xml/file_paths.xml ğŸŸ¢</li>
<li>å·¥ç¨‹çº§build.gradle ğŸŸ¡</li>
<li>res/layout/splash.xmlğŸŸ¢</li>
<li>res/values/strings.xmlğŸŸ¡</li>
<li>åº”ç”¨çº§build.gradle ğŸŸ¡</li>
<li>æ¸…å•æ–‡ä»¶AndroidManifest.xmlğŸŸ¡</li>
<li>app/src/org/cocos2dx/javascript/CocosApplication.javağŸŸ¢</li>
<li>app/src/org/cocos2dx/javascript/SplashActivity.javağŸŸ¢</li>
<li>app/src/org/cocos2dx/javascript/AppActivity.javağŸŸ¡</li>
</ul>
<p><em>æ³¨é‡Š ğŸŸ¡ä»£è¡¨æ”¹æ–‡ä»¶æœ‰ä¿®æ”¹ ğŸŸ¢ä»£è¡¨æ–°å¢æ–‡ä»¶</em></p>
<h2 id="è¯¦ç»†ä¿®æ”¹å†…å®¹">è¯¦ç»†ä¿®æ”¹å†…å®¹</h2>
<p>ä¿®æ”¹Android Gradle Plugin Versionä¸º3.4.3,ä¿®æ”¹Gradle Versionä¸º5.1.1</p>
<figure data-type="image" tabindex="1"><img src="https://gbcat.github.io/post-images/1626750808206.webp" alt="" loading="lazy"></figure>
<p><strong>res/xml/file_paths.xml ğŸŸ¢</strong></p>
<p>åœ¨å¯¹åº”ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶,æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;paths xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
   &lt;external-path name=&quot;tt_external_root&quot; path=&quot;.&quot; /&gt;
   &lt;external-path name=&quot;tt_external_download&quot; path=&quot;Download&quot; /&gt;
   &lt;external-files-path name=&quot;tt_external_files_download&quot; path=&quot;Download&quot; /&gt;
   &lt;files-path name=&quot;tt_internal_file_download&quot; path=&quot;Download&quot; /&gt;
   &lt;cache-path name=&quot;tt_internal_cache_download&quot; path=&quot;Download&quot; /&gt;
&lt;/paths&gt;
</code></pre>
<p><strong>å·¥ç¨‹çº§build.gradle ğŸŸ¡</strong></p>
<p>ä¿®æ”¹å¹¶æ·»åŠ ä¾èµ–æº</p>
<pre><code>buildscript {
    repositories {
        google()
        jcenter()
        maven { url 'https://repo1.maven.org/maven2/' }
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:3.4.3'
    }
}
allprojects {
    repositories {
        google()
        jcenter()
        flatDir {
            dirs 'libs'
        }
        maven {url 'https://artifact.bytedance.com/repository/pangle'}
        maven { url 'https://repo1.maven.org/maven2/' }
    }
}
</code></pre>
<p><strong>res/layout/splash.xmlğŸŸ¢</strong></p>
<p>åœ¨å¯¹åº”ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶,æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;
    android:background=&quot;#000000&quot;&gt;
    &lt;FrameLayout
        android:id=&quot;@+id/splash_container&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;
        android:background=&quot;#000000&quot;
        &gt;
    &lt;/FrameLayout&gt;
&lt;/LinearLayout&gt;
</code></pre>
<p><strong>res/values/strings.xmlğŸŸ¡</strong></p>
<p>ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼ŒæŒ‰ç…§éœ€è¦æ‰‹åŠ¨ä¿®æ”¹</p>
<pre><code>&lt;resources&gt;
    &lt;string name=&quot;app_name&quot; translatable=&quot;false&quot;&gt;åº”ç”¨åç§°&lt;/string&gt;
    &lt;string name=&quot;app_id&quot; translatable=&quot;false&quot;&gt;ç©¿å±±ç”²ID&lt;/string&gt;
    &lt;string name=&quot;splash_id&quot; translatable=&quot;false&quot;&gt;å¼€å±å¹¿å‘ŠID&lt;/string&gt;
    &lt;string name=&quot;video_id&quot; translatable=&quot;false&quot;&gt;æ¿€åŠ±è§†é¢‘ID&lt;/string&gt;
    &lt;string name=&quot;express_id&quot; translatable=&quot;false&quot;&gt;æ¨¡æ¿æ¸²æŸ“æ’å±ID&lt;/string&gt;
    &lt;string name=&quot;banner_id&quot; translatable=&quot;false&quot;&gt;æ¨¡æ¿æ¸²æŸ“BannerID&lt;/string&gt;
    &lt;string name=&quot;um_id&quot; translatable=&quot;false&quot;&gt;å‹ç›ŸID&lt;/string&gt;
    &lt;string name=&quot;um_channel&quot; translatable=&quot;false&quot;&gt;å‹ç›Ÿå¹³å°æ ‡è¯†&lt;/string&gt;
&lt;/resources&gt;
</code></pre>
<p><strong>åº”ç”¨çº§build.gradle ğŸŸ¡</strong></p>
<p>å› ä¸ºæ€•éº»çƒ¦ï¼Œç›´æ¥å…³é—­æ··æ·†</p>
<pre><code>minifyEnabled false
shrinkResources false
</code></pre>
<p>ä¿®æ”¹å¹¶æ·»åŠ å¼•å…¥</p>
<pre><code>dependencies {
    implementation fileTree(dir: '../libs', include: ['*.jar', '*.aar'])
    implementation fileTree(dir: 'libs', include: ['*.jar', '*.aar'])
    implementation fileTree(dir: &quot;C:/CocosDashboard/resources/.editors/Creator/2.4.5/resources/cocos2d-x/cocos/platform/android/java/libs&quot;, include: ['*.jar'])
    implementation project(':libcocos2dx')
    implementation 'com.pangle.cn:ads-sdk:3.5.0.6'
    implementation('com.android.support:support-v4:24.2.0')
    implementation  'com.umeng.umsdk:common:9.4.0'
    implementation  'com.umeng.umsdk:asms:1.2.3'
}
</code></pre>
<p><strong>æ¸…å•æ–‡ä»¶AndroidManifest.xmlğŸŸ¡</strong></p>
<p>æ ¹æ®æä¾›çš„codeè‡ªè¡Œä¿®æ”¹</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    package=&quot;com.leningmeng.jsdzz.vivoo&quot;
    android:installLocation=&quot;auto&quot;&gt;
    &lt;uses-feature android:glEsVersion=&quot;0x00020000&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;
    &lt;!--ç©¿å±±ç”²uses-permission--&gt;
    &lt;!--å¿…è¦æƒé™--&gt;
    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
    &lt;!--å¯é€‰æƒé™--&gt;
    &lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.REQUEST_INSTALL_PACKAGES&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.GET_TASKS&quot; /&gt;
    &lt;!--å¯é€‰ï¼Œç©¿å±±ç”²æä¾›â€œè·å–åœ°ç†ä½ç½®æƒé™â€å’Œâ€œä¸ç»™äºˆåœ°ç†ä½ç½®æƒé™ï¼Œå¼€å‘è€…ä¼ å…¥åœ°ç†ä½ç½®å‚æ•°â€ä¸¤ç§æ–¹å¼ä¸ŠæŠ¥ç”¨æˆ·ä½ç½®ï¼Œä¸¤ç§æ–¹å¼å‡å¯ä¸é€‰ï¼Œæ·»åŠ ä½ç½®æƒé™æˆ–å‚æ•°å°†å¸®åŠ©æŠ•æ”¾å®šä½å¹¿å‘Š--&gt;
    &lt;!--è¯·æ³¨æ„ï¼šæ— è®ºé€šè¿‡ä½•ç§æ–¹å¼æä¾›ç»™ç©¿å±±ç”²ç”¨æˆ·åœ°ç†ä½ç½®ï¼Œå‡éœ€å‘ç”¨æˆ·å£°æ˜åœ°ç†ä½ç½®æƒé™å°†åº”ç”¨äºç©¿å±±ç”²å¹¿å‘ŠæŠ•æ”¾ï¼Œç©¿å±±ç”²ä¸å¼ºåˆ¶è·å–åœ°ç†ä½ç½®ä¿¡æ¯--&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;
    &lt;!-- å¦‚æœè§†é¢‘å¹¿å‘Šä½¿ç”¨textureViewæ’­æ”¾ï¼Œè¯·åŠ¡å¿…æ·»åŠ ï¼Œå¦åˆ™é»‘å± --&gt;
    &lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;
    &lt;!--demoåœºæ™¯ç”¨åˆ°çš„æƒé™ï¼Œä¸æ˜¯å¿…é¡»çš„--&gt;
    &lt;uses-permission android:name=&quot;android.permission.RECEIVE_USER_PRESENT&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.EXPAND_STATUS_BAR&quot; /&gt;
    &lt;!-- ç©¿å±±ç”²3400ç‰ˆæœ¬æ–°å¢ï¼šå»ºè®®æ·»åŠ â€œquery_all_packageâ€æƒé™ï¼Œç©¿å±±ç”²å°†é€šè¿‡æ­¤æƒé™åœ¨Android Rç³»ç»Ÿä¸Šåˆ¤å®šå¹¿å‘Šå¯¹åº”çš„åº”ç”¨æ˜¯å¦åœ¨ç”¨æˆ·çš„appä¸Šå®‰è£…ï¼Œé¿å…æŠ•æ”¾é”™è¯¯çš„å¹¿å‘Šï¼Œä»¥æ­¤æé«˜ç”¨æˆ·çš„å¹¿å‘Šä½“éªŒã€‚è‹¥æ·»åŠ æ­¤æƒé™ï¼Œéœ€è¦åœ¨æ‚¨çš„ç”¨æˆ·éšç§æ–‡æ¡£ä¸­å£°æ˜ï¼ --&gt;
    &lt;uses-permission
        android:name=&quot;android.permission.QUERY_ALL_PACKAGES&quot;
        tools:ignore=&quot;QueryAllPackagesPermission&quot; /&gt;
    &lt;!--ç©¿å±±ç”²uses-permission--&gt;
    &lt;application
        android:name=&quot;org.cocos2dx.javascript.CocosApplication&quot;
        android:allowBackup=&quot;true&quot;
        android:icon=&quot;@mipmap/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:usesCleartextTraffic=&quot;true&quot;&gt;
        &lt;!-- Tell Cocos2dxActivity the name of our .so --&gt;
        &lt;meta-data
            android:name=&quot;android.app.lib_name&quot;
            android:value=&quot;cocos2djs&quot; /&gt;
        &lt;activity
            android:name=&quot;org.cocos2dx.javascript.SplashActivity&quot;
            android:configChanges=&quot;orientation|keyboardHidden|screenSize|screenLayout&quot;
            android:label=&quot;@string/app_name&quot;
            android:launchMode=&quot;singleTask&quot;
            android:screenOrientation=&quot;portrait&quot;
            android:taskAffinity=&quot;&quot;
            android:theme=&quot;@android:style/Theme.NoTitleBar.Fullscreen&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
        &lt;activity
            android:name=&quot;org.cocos2dx.javascript.AppActivity&quot;
            android:configChanges=&quot;orientation|keyboardHidden|screenSize|screenLayout&quot;
            android:label=&quot;@string/app_name&quot;
            android:launchMode=&quot;singleTask&quot;
            android:screenOrientation=&quot;portrait&quot;
            android:taskAffinity=&quot;&quot;
            android:theme=&quot;@android:style/Theme.NoTitleBar.Fullscreen&quot;&gt;
        &lt;/activity&gt;
        &lt;provider
            android:name=&quot;com.bytedance.sdk.openadsdk.TTFileProvider&quot;
            android:authorities=&quot;${applicationId}.TTFileProvider&quot;
            android:exported=&quot;false&quot;
            android:grantUriPermissions=&quot;true&quot;&gt;
            &lt;meta-data
                android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot;
                android:resource=&quot;@xml/file_paths&quot; /&gt;
        &lt;/provider&gt;
        &lt;provider
            android:name=&quot;com.bytedance.sdk.openadsdk.multipro.TTMultiProvider&quot;
            android:authorities=&quot;${applicationId}.TTMultiProvider&quot;
            android:exported=&quot;false&quot; /&gt;
    &lt;/application&gt;
&lt;/manifest&gt;
</code></pre>
<p><strong>app/src/org/cocos2dxj/avascript/CocosApplication.javağŸŸ¢</strong></p>
<p>æ–°å»ºCocosApplicationå¹¶æ·»åŠ å†…å®¹,æ³¨æ„R.stringéœ€è¦é‡æ–°å¼•ç”¨</p>
<pre><code>package org.cocos2dx.javascript;
import android.app.Application;
import com.bytedance.sdk.openadsdk.TTAdConfig;
import com.bytedance.sdk.openadsdk.TTAdConstant;
import com.bytedance.sdk.openadsdk.TTAdManager;
import com.bytedance.sdk.openadsdk.TTAdSdk;
import com.leningmeng.jsdzz.vivoo.R;
import com.umeng.analytics.MobclickAgent;
import com.umeng.commonsdk.UMConfigure;
public class CocosApplication extends Application {
    @Override
    public void onCreate() {
        super.onCreate();
        TTAdSdk.init(this,
                new TTAdConfig.Builder()
                        .appId(this.getString(R.string.app_id))
                        .useTextureView(true) //é»˜è®¤ä½¿ç”¨SurfaceViewæ’­æ”¾è§†é¢‘å¹¿å‘Š,å½“æœ‰SurfaceViewå†²çªçš„åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨TextureView
                        .appName(this.getString(R.string.app_name))
                        .titleBarTheme(TTAdConstant.TITLE_BAR_THEME_DARK)//è½åœ°é¡µä¸»é¢˜
                        .allowShowNotify(true) //æ˜¯å¦å…è®¸sdkå±•ç¤ºé€šçŸ¥æ æç¤º
                        .debug(true) //æµ‹è¯•é˜¶æ®µæ‰“å¼€ï¼Œå¯ä»¥é€šè¿‡æ—¥å¿—æ’æŸ¥é—®é¢˜ï¼Œä¸Šçº¿æ—¶å»é™¤è¯¥è°ƒç”¨
                        .directDownloadNetworkType(TTAdConstant.NETWORK_STATE_WIFI) //å…è®¸ç›´æ¥ä¸‹è½½çš„ç½‘ç»œçŠ¶æ€é›†åˆ,æ²¡æœ‰è®¾ç½®çš„ç½‘ç»œä¸‹ç‚¹å‡»ä¸‹è½½apkä¼šæœ‰äºŒæ¬¡ç¡®è®¤å¼¹çª—ï¼Œå¼¹çª—ä¸­ä¼šæŠ«éœ²åº”ç”¨ä¿¡æ¯
                        .supportMultiProcess(false) //æ˜¯å¦æ”¯æŒå¤šè¿›ç¨‹ï¼Œtrueæ”¯æŒ
                        .asyncInit(true) //æ˜¯å¦å¼‚æ­¥åˆå§‹åŒ–sdk,è®¾ç½®ä¸ºtrueå¯ä»¥å‡å°‘SDKåˆå§‹åŒ–è€—æ—¶ã€‚3450ç‰ˆæœ¬å¼€å§‹åºŸå¼ƒ~~
                        .build());
        TTAdManager ttAdManager = TTAdSdk.getAdManager();
        ttAdManager.requestPermissionIfNecessary(this);
        UMConfigure.init(this, this.getString(R.string.um_id), this.getString(R.string.um_channel), UMConfigure.DEVICE_TYPE_PHONE, &quot;&quot;);
        MobclickAgent.setPageCollectionMode(MobclickAgent.PageMode.AUTO);
    }
}
</code></pre>
<p><strong>app/src/org/cocos2dx/javascript/SplashActivity.javağŸŸ¢</strong></p>
<p>æ–°å»ºSplashActivityæ–‡ä»¶</p>
<pre><code>package org.cocos2dx.javascript;
import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.FrameLayout;
import com.bytedance.sdk.openadsdk.AdSlot;
import com.bytedance.sdk.openadsdk.TTAdNative;
import com.bytedance.sdk.openadsdk.TTAdSdk;
import com.bytedance.sdk.openadsdk.TTSplashAd;
import com.leningmeng.jsdzz.vivoo.R;
public class SplashActivity  extends Activity {
    private FrameLayout mSplashContainer;
    String TAG = &quot;SplashActivity&quot;;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.splash);
        mSplashContainer = (FrameLayout) findViewById(R.id.splash_container);
        TTAdNative mTTAdNative = TTAdSdk.getAdManager().createAdNative(this);
        AdSlot adSlot = new AdSlot.Builder()
                .setCodeId(this.getString(R.string.splash_id))
                .setImageAcceptedSize(1080, 1920)
                .build();
        mTTAdNative.loadSplashAd(adSlot, new TTAdNative.SplashAdListener() {
            @Override
            public void onError(int i, String s) {
                Log.e(TAG,s);
                jumpToAppActivity();
            }
            @Override
            public void onTimeout() {
                Log.e(TAG,&quot;onTimeout&quot;);
                jumpToAppActivity();
            }
            @Override
            public void onSplashAdLoad(TTSplashAd ttSplashAd) {
                Log.e(TAG,&quot;onSplashAdLoad&quot;);
                if (ttSplashAd == null) {
                    return;
                }
                //è·å–SplashView
                View view = ttSplashAd.getSplashView();
                if (view != null &amp;&amp; mSplashContainer != null &amp;&amp; !SplashActivity.this.isFinishing()) {
                    mSplashContainer.removeAllViews();
                    //æŠŠSplashView æ·»åŠ åˆ°ViewGroupä¸­,æ³¨æ„å¼€å±å¹¿å‘Šviewï¼šwidth =å±å¹•å®½ï¼›height &gt;=75%å±å¹•é«˜
                    mSplashContainer.addView(view);
                    //è®¾ç½®ä¸å¼€å¯å¼€å±å¹¿å‘Šå€’è®¡æ—¶åŠŸèƒ½ä»¥åŠä¸æ˜¾ç¤ºè·³è¿‡æŒ‰é’®,å¦‚æœè¿™ä¹ˆè®¾ç½®ï¼Œæ‚¨éœ€è¦è‡ªå®šä¹‰å€’è®¡æ—¶é€»è¾‘
                    //ad.setNotAllowSdkCountdown();
                    ttSplashAd.setSplashInteractionListener(new TTSplashAd.AdInteractionListener(){
                        @Override
                        public void onAdClicked(View view, int i) {
                        }
                        @Override
                        public void onAdShow(View view, int i) {
                        }
                        @Override
                        public void onAdSkip() {
                            jumpToAppActivity();
                        }
                        @Override
                        public void onAdTimeOver() {
                            jumpToAppActivity();
                        }
                    });
                }else {
                    jumpToAppActivity();
                }
            }
        });
    }
    /**
     * è·³è½¬åˆ°AppActivity
     */
    public void jumpToAppActivity(){
        Intent intent = new Intent(this, AppActivity.class);
        startActivity(intent);
        SplashActivity.this.finish();
    }
}
</code></pre>
<p><strong>app/src/org/cocos2dx/javascript/AppActivity.javağŸŸ¡</strong></p>
<p>æ›¿æ¢importå¼•ç”¨éƒ¨åˆ†</p>
<pre><code>import org.cocos2dx.lib.Cocos2dxActivity;
import org.cocos2dx.lib.Cocos2dxGLSurfaceView;
import org.cocos2dx.lib.Cocos2dxJavascriptJavaBridge;
import android.os.Bundle;
import android.content.Intent;
import android.content.res.Configuration;
import android.os.Handler;
import android.os.Message;
import android.util.Log;
import android.view.Gravity;
import android.view.View;
import android.widget.FrameLayout;
import android.widget.LinearLayout;
import com.bytedance.sdk.openadsdk.AdSlot;
import com.bytedance.sdk.openadsdk.TTAdConstant;
import com.bytedance.sdk.openadsdk.TTAdNative;
import com.bytedance.sdk.openadsdk.TTAdSdk;
import com.bytedance.sdk.openadsdk.TTNativeExpressAd;
import com.bytedance.sdk.openadsdk.TTRewardVideoAd;
import com.leningmeng.jsdzz.vivoo.R;
import java.util.List;
</code></pre>
<p>æ›¿æ¢protected void onCreateä¸ºä»¥ä¸‹å†…å®¹</p>
<pre><code>String TAG = &quot;AppActivity&quot;;
    protected Boolean isVideoComplete = false;
    protected static String videoCallBackName = &quot;&quot;;
    static Handler handler;
    TTNativeExpressAd bannerAd;
    LinearLayout BannerLayout;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        // Workaround in
        // https://stackoverflow.com/questions/16283079/re-launch-of-activity-on-home-button-but-only-the-first-time/16447508
        if (!isTaskRoot()) {
            // Android launched another instance of the root activity into an existing task
            // so just quietly finish and go away, dropping the user back into the activity
            // at the top of the stack (ie: the last state of this task)
            // Don't need to finish it again since it's finished in super.onCreate .
            return;
        }
        // DO OTHER INITIALIZATION BELOW
        SDKWrapper.getInstance().init(this);
        handler = new Handler() {
            public void handleMessage(Message msg) {
                switch (msg.what) {
                    case 1:
                        playVideoAd(); //æ’­æ”¾è§†é¢‘å¹¿å‘Š
                        break;
                    case 2:
                        showExpressAd(); //å±•ç¤ºæ¨¡æ¿æ¸²æŸ“æ’å±
                        break;
                    case 3:
                        showBannerAd(); //å±•ç¤ºæ¨¡æ¿æ¸²æŸ“æ’å±
                        break;
                    case 4:
                        hideBannerAd(); //å±•ç¤ºæ¨¡æ¿æ¸²æŸ“æ’å±
                        break;
                    default:
                        break;
                }
            }
        };
        BannerLayout= new LinearLayout(AppActivity.this);
        BannerLayout.setOrientation(LinearLayout.VERTICAL);
        BannerLayout.setGravity(Gravity.CENTER|Gravity.BOTTOM);
        FrameLayout.LayoutParams lParams = new FrameLayout.LayoutParams(
                FrameLayout.LayoutParams.MATCH_PARENT,
                FrameLayout.LayoutParams.MATCH_PARENT);
        AppActivity.this.addContentView(BannerLayout,lParams);
    }
    /**
     * ç›‘å¬Cocosç«¯å‘é€çš„Bannerå±•ç¤ºè¯·æ±‚
     */
    public static void onCocosShowBannerAd() {
        Message msg = new Message();
        msg.what = 3;
        handler.sendMessage(msg);
    }
    /**
     * ç›‘å¬Cocosç«¯å‘é€çš„Banneré”€æ¯è¯·æ±‚
     */
    public static void onCocosHideBannerAd() {
        Message msg = new Message();
        msg.what = 4;
        handler.sendMessage(msg);
    }
    /**
     * å±•ç¤ºBannerå¹¿å‘Š
     */
    public void showBannerAd(){
        Log.e(TAG,&quot;å±•ç¤ºBannerå¹¿å‘Š&quot;);
        TTAdNative mTTAdNative = TTAdSdk.getAdManager().createAdNative(this);
        AdSlot adSlot = new AdSlot.Builder()
                .setCodeId(this.getString(R.string.banner_id)) //å¹¿å‘Šä½id
                .setSupportDeepLink(true)
                .setAdCount(1)
                .setExpressViewAcceptedSize(600,90) //æœŸæœ›æ¨¡æ¿å¹¿å‘Šviewçš„size,å•ä½dp
                .build();
        mTTAdNative.loadBannerExpressAd(adSlot, new TTAdNative.NativeExpressAdListener() {
            //è¯·æ±‚å¤±è´¥å›è°ƒ
            @Override
            public void onError(int code, String message) {
                Log.e(TAG,message);
            }
            //è¯·æ±‚æˆåŠŸå›è°ƒ
            @Override
            public void onNativeExpressAdLoad(List&lt;TTNativeExpressAd&gt; ads) {
                Log.e(TAG,&quot;Bannerå¹¿å‘Šè¯·æ±‚æˆåŠŸ&quot;+ads.size());
                bannerAd = ads.get(0);
                bannerAd.render();
                bannerAd.setExpressInteractionListener(new TTNativeExpressAd.ExpressAdInteractionListener() {
                    //å¹¿å‘Šç‚¹å‡»å›è°ƒ
                    @Override
                    public void onAdClicked(View view, int type) {
                        Log.e(TAG,&quot;onAdClicked&quot;);
                    }
                    //å¹¿å‘Šå±•ç¤ºå›è°ƒ
                    @Override
                    public void onAdShow(View view, int type) {
                        Log.e(TAG,&quot;onAdShow&quot;);
                    }
                    //å¹¿å‘Šæ¸²æŸ“å¤±è´¥å›è°ƒ
                    @Override
                    public void onRenderFail(View view, String msg, int code) {
                        Log.e(TAG,&quot;onRenderFail&quot;);
                    }
                    //å¹¿å‘Šæ¸²æŸ“æˆåŠŸå›è°ƒ
                    @Override
                    public void onRenderSuccess(View view, float width, float height) {
                        Log.e(TAG,&quot;onRenderSuccess&quot;);
                        BannerLayout.removeAllViews();
                        BannerLayout.addView(bannerAd.getExpressAdView());
                    }
                });
            }
        });
    }
    public void hideBannerAd(){
        if(bannerAd != null){
            bannerAd.destroy();
            bannerAd = null;
        }
    }
    /**
     * ç›‘å¬Cocosç«¯å‘é€çš„æ’å±å¹¿å‘Šå±•ç¤ºè¯·æ±‚
     */
    public static void onCocosShowExpressAd() {
        Message msg = new Message();
        msg.what = 2;
        handler.sendMessage(msg);
    }
    /**
     * å±•ç¤ºæ¨¡æ¿æ¸²æŸ“æ’å±
     */
    public void showExpressAd() {
        TTAdNative mTTAdNative = TTAdSdk.getAdManager().createAdNative(this);
        AdSlot adSlot = new AdSlot.Builder()
                .setCodeId(this.getString(R.string.express_id)) //å¹¿å‘Šä½id
                .setSupportDeepLink(true)
                .setAdCount(1)
                .setExpressViewAcceptedSize(300, 300) //æœŸæœ›æ¨¡æ¿å¹¿å‘Šviewçš„size,å•ä½dp
                .build();
        mTTAdNative.loadInteractionExpressAd(adSlot, new TTAdNative.NativeExpressAdListener() {
            //è¯·æ±‚å¹¿å‘Šå¤±è´¥
            @Override
            public void onError(int code, String message) {
            }
            //è¯·æ±‚å¹¿å‘ŠæˆåŠŸ
            @Override
            public void onNativeExpressAdLoad(final List&lt;TTNativeExpressAd&gt; ads) {
                ads.get(0).render();
                ads.get(0).setExpressInteractionListener(new TTNativeExpressAd.AdInteractionListener() {
                    //å¹¿å‘Šå…³é—­å›è°ƒ
                    @Override
                    public void onAdDismiss() {
                    }
                    //å¹¿å‘Šç‚¹å‡»å›è°ƒ
                    @Override
                    public void onAdClicked(View view, int type) {
                    }
                    //å¹¿å‘Šå±•ç¤ºå›è°ƒ
                    @Override
                    public void onAdShow(View view, int type) {
                    }
                    //å¹¿å‘Šæ¸²æŸ“å¤±è´¥å›è°ƒ
                    @Override
                    public void onRenderFail(View view, String msg, int code) {
                    }
                    //å¹¿å‘Šæ¸²æŸ“æˆåŠŸå›è°ƒ
                    @Override
                    public void onRenderSuccess(View view, float width, float height) {
                        //åœ¨æ¸²æŸ“æˆåŠŸå›è°ƒæ—¶å±•ç¤ºå¹¿å‘Šï¼Œæå‡ä½“éªŒ
                        ads.get(0).showInteractionExpressAd(AppActivity.this);
                    }
                });
            }
        });
    }
    /**
     * ç›‘å¬Cocosç«¯å‘é€çš„æ¿€åŠ±è§†é¢‘æ’­æ”¾è¯·æ±‚
     *
     * @param callBackName æ¿€åŠ±è§†é¢‘å®Œæˆå›è°ƒæ–¹æ³•å
     */
    public static void onCocosPlayVideoAd(String callBackName) {
        videoCallBackName = callBackName;
        Message msg = new Message();
        msg.what = 1;
        handler.sendMessage(msg);
    }
    TTRewardVideoAd videoAd;
    public void playVideoAd() {
        isVideoComplete = false;
        TTAdNative mTTAdNative = TTAdSdk.getAdManager().createAdNative(this);
        AdSlot adSlot = new AdSlot.Builder()
                .setCodeId(this.getString(R.string.video_id))
                .setOrientation(TTAdConstant.VERTICAL)//TTAdConstant.HORIZONTAL æˆ– TTAdConstant.VERTICAL
                .build();
        mTTAdNative.loadRewardVideoAd(adSlot, new TTAdNative.RewardVideoAdListener() {
            @Override
            public void onError(int i, String s) {
                Log.e(TAG, s);
            }
            @Override
            public void onRewardVideoAdLoad(TTRewardVideoAd ttRewardVideoAd) {
                Log.e(TAG, &quot;onRewardVideoAdLoad&quot;);
                videoAd = ttRewardVideoAd;
                if (videoAd != null) {
                    videoAd.setRewardAdInteractionListener(new TTRewardVideoAd.RewardAdInteractionListener() {
                        @Override
                        public void onAdShow() {
                            Log.e(TAG, &quot;onAdShow&quot;);
                        }
                        @Override
                        public void onAdVideoBarClick() {
                            Log.e(TAG, &quot;onAdVideoBarClick&quot;);
                        }
                        @Override
                        public void onAdClose() {
                            Log.e(TAG, &quot;onAdClose&quot;);
                            if (isVideoComplete) {
                                //æ¿€åŠ±å›è°ƒ
                                toCocos(videoCallBackName);
                            }
                        }
                        @Override
                        public void onVideoComplete() {
                            Log.e(TAG, &quot;onVideoComplete&quot;);
                            isVideoComplete = true;
                        }
                        @Override
                        public void onVideoError() {
                            Log.e(TAG, &quot;onVideoError&quot;);
                        }
                        @Override
                        public void onRewardVerify(boolean b, int i, String s, int i1, String s1) {
                            Log.e(TAG, &quot;onRewardVerify&quot;);
                        }
                        @Override
                        public void onSkippedVideo() {
                            Log.e(TAG, &quot;onSkippedVideo&quot;);
                        }
                    });
                } else {
                    Log.e(TAG, &quot;è¯·å…ˆåŠ è½½å¹¿å‘Š&quot;);
                }
            }
            @Override
            public void onRewardVideoCached() {
                Log.e(TAG, &quot;onRewardVideoCached&quot;);
                videoAd.showRewardVideoAd(AppActivity.this, TTAdConstant.RitScenes.CUSTOMIZE_SCENES, &quot;scenes_test&quot;);
            }
        });
    }
    public void toCocos(final String msg) {
        Log.e(TAG, msg);
        this.runOnGLThread(new Runnable() {
            @Override
            public void run() {
                Cocos2dxJavascriptJavaBridge.evalString(msg + &quot;();&quot;);
            }
        });
    }
</code></pre>
<h2 id="cocosç«¯ä»£ç ç¤ºä¾‹">Cocosç«¯ä»£ç ç¤ºä¾‹</h2>
<p><strong>æ¿€åŠ±è§†é¢‘</strong></p>
<pre><code>cc.ad.videoCallBack = function () {
    obj.success &amp;&amp; obj.success();
}
jsb.reflection.callStaticMethod(&quot;org/cocos2dx/javascript/AppActivity&quot;, &quot;onCocosPlayVideoAd&quot;, &quot;(Ljava/lang/String;)V&quot;, &quot;cc.ad.videoCallBack&quot;);
</code></pre>
<p><strong>bannerå’Œæ’å±</strong></p>
<pre><code>/å±•ç¤ºBanner
jsb.reflection.callStaticMethod(&quot;org/cocos2dx/javascript/AppActivity&quot;, &quot;onCocosShowBannerAd&quot;, &quot;()V&quot;);
//éšè—Banner
jsb.reflection.callStaticMethod(&quot;org/cocos2dx/javascript/AppActivity&quot;, &quot;onCocosHideBannerAd&quot;, &quot;()V&quot;);
//å±•ç¤ºæ’å±
jsb.reflection.callStaticMethod(&quot;org/cocos2dx/javascript/AppActivity&quot;, &quot;onCocosShowExpressAd&quot;, &quot;()V&quot;);
</code></pre>
]]></content>
    </entry>
</feed>